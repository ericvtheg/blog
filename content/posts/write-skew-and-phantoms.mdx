---
title: Write Skews and Phantoms
description: Transactions help us avoid conflicts on data that exists, but what about data that doesn't exist?
date: "2023-08-08"
---

As application developers, database transactions abstract us away from [concurrency control](https://www.geeksforgeeks.org/concurrency-control-in-dbms/#)
to let us design our systems as if just a single process is modifying state serially. [1] {/* 233 */}
Unfortunately it is not that simple.

Disclaimer: This article is influenced by Martin Kleppmann's book, _Designing Data-Intensive Applications_.

<p align="center">
  <a
    alt="Designing Data-Intensive Applications by Martin Kleppmann"
    target="_blank"
    href="https://www.amazon.com/Designing-Data-Intensive-Applications-Reliable-Maintainable/dp/1449373321/ref=sr_1_1?keywords=martin+kleppmann%2527s+designing+data-intensive+applications&amp;qid=1691551612&amp;sprefix=martin+klep%252Caps%252C192&amp;sr=8-1&_encoding=UTF8&tag=ericventor-20&linkCode=ur2&linkId=e1be69645fddf1c77e3edaeafb9d9c2a&camp=1789&creative=9325"
  >
    ![](https://encrypted-tbn3.gstatic.com/images?q=tbn:ANd9GcSlR4hC5tiypE9ftFBwNG1qi90tsMqcjs3cZB1vZrk7qZ5YV3dt)
    Designing Data-Intensive Applications by Martin Kleppmann
  </a>
</p>

## Transactions & Concurrency Control

Database transactions give us the illusion that all operations are done serially.
If all our database operations were done serially we wouldn't need to worry about our
data being manipulated in ways we didn't anticipate.

This illusion is done through concurrency control via transaction isolation.
Transaction isolation can have detrimental _gotchas_ that we must be aware of.
In order to build robust systems we must thoroughly understand how transactions
work and what level of isolation our database is providing.

Before diving into transcation isolation, lets discuss what we are trying to avoid.

## Race Conditions

Race conditions can occur when multiple processes are attempting to modify data at the same time
leading to situations where unexpected cases can occur.

An example of a race condition can be as benign as a user creating an account
but not seeing their profile when they refresh the page.
[A race condition can also be as sinister as bankrupting an exchange](https://old.reddit.com/r/Bitcoin/comments/1wtbiu/how_i_stole_roughly_100_btc_from_an_exchange_and/).

Race conditions are tricky to test for because they only occur when we get unlucky with timing. [2] {/* 233 */}

To understand the depth of what in our software stack can be 'unlucky' we must have cognizance
from the top of the software stack all the way to hardware at the bottom

Some examples include:

- network
- yielding cpu in a VM (pg 282)

> In distributed systems, suspicion, pessimism, and paranoia pay off.

<cite>&mdash; Martin Kleppmann</cite>

In order to build robust and dependable applications, if something can happen, then we must assume it will happen.

## Transaction Isolation

I think I just write about transaction isolation and save write skew for another time

# Write Skew

We can prevent changing things that exist, but we can't prevent changing things that do not exist.

## Phantoms

(example)
